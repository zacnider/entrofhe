# EntropyHandleLifecycle

Understanding handles and symbolic execution with EntropyOracle

## üìã Overview

This example demonstrates **handles** concepts in FHEVM with **EntropyOracle integration**:
- What are handles?
- How handles are generated
- Symbolic execution in FHEVM
- Handle lifecycle and permissions
- EntropyOracle handle management

## üí° Key Concepts

### EntropyOracle Integration
The contract uses EntropyOracle to demonstrate entropy handle lifecycle:
```solidity
IEntropyOracle entropyOracle;
euint64 entropyHandle = entropyOracle.getEncryptedEntropy(requestId);
// entropyHandle is also a handle, not the actual encrypted data
```

### Entropy Handle Lifecycle
1. Request entropy from EntropyOracle ‚Üí returns requestId
2. Get entropy handle from oracle ‚Üí returns euint64 handle
3. Handle can be used in FHE operations
4. Handle can be returned for off-chain decryption

### Handles Explained
- **Handles** are references to encrypted values
- Generated by FHEVM SDK when encrypting values
- Generated by EntropyOracle when returning entropy
- Used to reference encrypted data in contracts
- Handles are NOT the actual encrypted data, just references

### Symbolic Execution
- FHEVM uses symbolic execution to track encrypted values
- Handles represent encrypted values symbolically
- Operations on handles are tracked symbolically
- Actual decryption happens off-chain

## üöÄ Quick Start

### Prerequisites

- Node.js 18+
- Hardhat
- Sepolia Testnet (for FHEVM)
- **Deployed EntropyOracle contract** (required for entropy examples)

### Installation

```bash
npm install
```

### Compile

```bash
npm run compile
```

### Test

```bash
npm test
```

**Note**: Full entropy tests require a deployed EntropyOracle contract. Set `ENTROPY_ORACLE_ADDRESS` environment variable.

## üìñ Usage Example

### Basic Handle Lifecycle

```typescript
// Deploy contract
const contract = await EntropyHandleLifecycleFactory.deploy(oracleAddress);

// Store handle
const input = hre.fhevm.createEncryptedInput(contractAddress, userAddress);
input.add64(42);
const encryptedInput = await input.encrypt();

await contract.storeHandle(encryptedInput.handles[0], encryptedInput.inputProof);

// Use handle in FHE operation
const result = await contract.useHandle(); // Returns another handle
```

### Entropy Handle Lifecycle

```typescript
// Request entropy (returns requestId, not handle)
const tag = ethers.id("handle-test");
const fee = await contract.entropyOracle.getFee();
const requestId = await contract.requestEntropy(tag, { value: fee });

// Wait for entropy to be ready
await waitForEntropy(requestId);

// Use entropy handle in FHE operation
const result = await contract.useEntropyHandle(requestId); // Returns handle
```

## üîó Related Examples

- [EntropyEncryption](../encryption-encryptsingle/) - Entropy-based encryption
- [Category: handles](../)

## üìù License

BSD-3-Clause-Clear
